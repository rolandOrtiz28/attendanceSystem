<% layout('/layouts/boilerplate') -%>
    <link rel="stylesheet" href="/stylesheet/attendance.css">
    <link rel="stylesheet" href="/stylesheet/personal.css">

    <div class="container-fluid">
        <a href="/attendance/monthly?month=<%= month %>" class="btn btn-sm btn-primary">Back to Monthly Records</a>
        <a href="/attendance/update/<%= label %>" class="btn btn-sm btn-warning ">Update Records</a>
        <h2 class="text-center">
            Personal Attendance Records for <%= label %> - <%= new Date(month).toLocaleDateString([], { year: 'numeric'
                    , month: 'long' }) %>
        </h2>

        <% Object.keys(recordsByClass).forEach(classLabel=> { %>
            <% if (recordsByClass[classLabel].length> 0) { %>
                <div class="table-container" style="overflow-x: auto;">
                    <h3 class="text-center">
                        <%= classLabel %>
                    </h3>
                    <table class="table align-middle mb-0 bg-white">
                        <thead class="bg-light">
                            <tr>
                                <th>Date</th>
                                <th>Time In</th>
                                <th>Time Out</th>
                            </tr>
                        </thead>
                        <tbody>
                            <% recordsByClass[classLabel].forEach(record=> { %>
                                <tr>
                                    <td>
                                        <%= new Date(record.timeIn).toLocaleDateString() %>
                                    </td>
                                    <td>
                                        <p class="time-in" data-time="<%= new Date(record.timeIn).toISOString() %>">
                                            <%= new Date(record.timeIn).toLocaleTimeString([], { hour: '2-digit' ,
                                                minute: '2-digit' }) %>
                                        </p>
                                    </td>
                                    <td>
                                        <% if (record.timeOut) { %>
                                            <p class="time-out"
                                                data-time="<%= new Date(record.timeOut).toISOString() %>">
                                                <%= new Date(record.timeOut).toLocaleTimeString([], { hour: '2-digit' ,
                                                    minute: '2-digit' }) %>
                                            </p>
                                            <% } else { %>
                                                <p class="time-out">Not Checked Out</p>
                                                <% } %>
                                    </td>
                                </tr>
                                <% }) %>
                        </tbody>
                    </table>
                </div>
                <% } %>
                    <% }) %>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.1/moment.min.js"></script>
    <script
        src="https://cdnjs.cloudflare.com/ajax/libs/moment-timezone/0.5.34/moment-timezone-with-data.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const timeElements = document.querySelectorAll('.time-in, .time-out');
            timeElements.forEach(el => {
                const timeString = el.getAttribute('data-time');
                if (timeString) {
                    const localTime = moment(timeString).tz(moment.tz.guess()).format('hh:mm A');
                    el.textContent = localTime;
                }
            });
        });
    </script>