<% layout('/layouts/boilerplate') -%>
  <link rel="stylesheet" href="/stylesheet/attendance.css">
  <link rel="stylesheet" href="/stylesheet/monthly.css">

  <div class="container-fluid">
    <a href="/attendance" class="btn btn-sm btn-primary">Back</a>
    <h2 class="text-center">
      Attendance Records for <%= new Date(month).toLocaleDateString([], { year: 'numeric' , month: 'long' }) %>
    </h2>

    <% Object.keys(recordsByClass).forEach(classLabel=> { %>
      <div class="table-container" style="overflow-x: auto;">
        <h3 class="text-center">
          <%= classLabel %>
        </h3>
        <table class="table align-middle mb-0 bg-white">
          <thead class="bg-light">
            <tr>
              <th>Name</th>
              <% for (let day=1; day <=new Date(new Date(month).getFullYear(), new Date(month).getMonth() + 1,
                0).getDate(); day++) { %>
                <th colspan="2">
                  <%= day %>
                </th>
                <% } %>
            </tr>
            <tr>
              <th></th>
              <% for (let day=1; day <=new Date(new Date(month).getFullYear(), new Date(month).getMonth() + 1,
                0).getDate(); day++) { %>
                <th>Time In</th>
                <th>Time Out</th>
                <% } %>
            </tr>
          </thead>
          <tbody>
            <% recordsByClass[classLabel].forEach(record=> { %>
              <% const day=new Date(record.timeIn).getDate(); %>
                <tr>
                  <td>
                    <%= record.label %>
                  </td>
                  <% for (let dayOfMonth=1; dayOfMonth <=new Date(new Date(month).getFullYear(), new
                    Date(month).getMonth() + 1, 0).getDate(); dayOfMonth++) { %>
                    <td>
                      <% if (dayOfMonth===day) { %>
                        <%= new Date(record.timeIn).toLocaleTimeString([], { hour: '2-digit' , minute: '2-digit' }) %>
                          <% } else { %>
                            N/A
                            <% } %>
                    </td>
                    <td>
                      <% if (dayOfMonth===day) { %>
                        <%= new Date(record.timeOut).toLocaleTimeString([], { hour: '2-digit' , minute: '2-digit' }) %>
                          <% } else { %>
                            N/A
                            <% } %>
                    </td>
                    <% } %>
                </tr>
                <% }) %>
          </tbody>
        </table>
      </div>
      <% }) %>
  </div>